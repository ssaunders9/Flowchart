<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSU Chemical Engineering Curriculum</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; background: #f5f5f5; }
        
        .skip-link { position: absolute; top: -40px; left: 0; background: #A60F2D; color: white; padding: 8px 16px; text-decoration: none; z-index: 100; font-weight: bold; }
        .skip-link:focus { top: 0; }
        
        header { background: #A60F2D; color: white; padding: 20px; margin-bottom: 30px; border-radius: 8px; }
        h1 { font-size: 1.8em; margin-bottom: 10px; }
        .subtitle { font-size: 1.1em; opacity: 0.9; }

        .program-selector { margin-top: 15px; }
        .program-selector label { font-size: 1em; font-weight: bold; margin-right: 10px; display: inline-block; }
        .program-selector select {
            font-size: 1em;
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px solid white;
            background: white;
            color: #A60F2D;
            font-weight: bold;
            cursor: pointer;
            min-width: 300px;
        }
        .program-selector select:focus {
            outline: 3px solid #fff;
            outline-offset: 2px;
        }
        .diagram-wrapper { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow-x: auto; position: relative; scroll-behavior: smooth; }
        .diagram-container { position: relative; min-width: 1600px; display: flex; gap: 30px; scroll-snap-type: x mandatory; }
        .semester-column { flex: 0 0 180px; display: flex; flex-direction: column; gap: 12px; scroll-snap-align: start; }
        .semester-header { font-size: 1em; font-weight: bold; color: white; background: #A60F2D; padding: 10px; border-radius: 6px; text-align: center; margin-bottom: 5px; }
        .course { padding: 10px; border-radius: 6px; border: 3px solid #333; min-height: 75px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; cursor: pointer; transition: all 0.2s ease; position: relative; }
        .course:focus { 
            outline: 3px solid #000; 
            outline-offset: 2px; 
            box-shadow: 0 0 0 5px rgba(166, 15, 45, 0.3);
            transform: translateY(-2px);
        }
        .course:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .course.engineering { background: #8fc9f7; border-color: #1565c0; color: #0d3c61; }
        .course.science { background: #a5d6a7; border-color: #2e7d32; color: #1b5e20; }
        .course.ucore { background: #ce93d8; border-color: #6a1b9a; color: #4a148c; }
        .course.technical { background: #bdbdbd; border-color: #616161; color: #212121; }
        .course-code { font-weight: bold; font-size: 1em; display: block; margin-bottom: 4px; text-align: center; }
        .course-name { font-size: 0.85em; display: block; margin-bottom: 4px; text-align: center; }
        .course-credits { font-size: 0.8em; display: block; text-align: center; }
        
        .relationship-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff9800;
            color: white;
            border-radius: 4px;
            padding: 3px 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: bold;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 200;
        }
        
        .relationship-badge.prereq { background: #ff9800; }
        .relationship-badge.coreq { background: #2196f3; }
        .relationship-badge.leadsto { background: #4caf50; }
        
        .notes-indicator {
            position: absolute;
            top: -8px;
            left: -8px;
            background: #757575;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
            font-weight: bold;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 200;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .notes-indicator:hover {
            transform: scale(1.1);
            background: #616161;
        }

        .alternatives-indicator {
            position: absolute;
            bottom: -8px;
            left: -8px;
            background: #616161;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6em;
            font-weight: bold;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 200;
            cursor: pointer;
            transition: transform 0.2s ease;
            line-height: 1;
        }

        .alternatives-indicator:hover {
            transform: scale(1.1);
            background: #424242;
        }
        
        .notes-tooltip {
            position: fixed;
            background: white;
            border: 2px solid #757575;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-width: 400px;
            z-index: 10000;
            display: none;
        }
        
        .notes-tooltip.visible {
            display: block;
        }
        
        .notes-tooltip[role="tooltip"] {
            outline: none;
        }
        
        .notes-tooltip-header {
            font-weight: bold;
            color: #424242;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .notes-tooltip-content {
            color: #333;
            line-height: 1.5;
        }
        
        .notes-tooltip-close {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            font-size: 1.2em;
            color: #666;
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }
        
        .notes-tooltip-close:hover {
            background: #f0f0f0;
            color: #333;
        }

        .alternatives-tooltip {
            border-color: #616161;
        }

        .alternatives-tooltip .notes-tooltip-header {
            color: #424242;
            border-bottom-color: #616161;
        }
        
        .text-semester { margin-bottom: 40px; }
        .text-semester h3 { color: #A60F2D; font-size: 1.4em; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #A60F2D; }
        .text-course { margin-bottom: 15px; padding: 15px; border-left: 5px solid #1565c0; background: #f5f5f5; border-radius: 4px; }
        .text-course.science { border-left-color: #2e7d32; }
        .text-course.ucore { border-left-color: #6a1b9a; }
        .text-course h4 { font-size: 1.1em; margin-bottom: 8px; color: #333; }
        .text-course p { margin: 5px 0; color: #666; }
        .keyboard-hint { background: #f0f0f0; padding: 15px; margin-bottom: 20px; border-radius: 6px; border-left: 4px solid #A60F2D; }
        .keyboard-hint h3 { font-size: 1em; margin-bottom: 8px; color: #A60F2D; cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: space-between; }
        .keyboard-hint h3:hover { color: #8a0c24; }
        .keyboard-hint h3::after { content: '▼'; font-size: 0.8em; transition: transform 0.3s ease; }
        .keyboard-hint h3.collapsed::after { transform: rotate(-90deg); }
        .keyboard-hint ul { margin-left: 20px; transition: all 0.3s ease; overflow: hidden; }
        .keyboard-hint ul.hidden { max-height: 0; opacity: 0; margin: 0; }
        .keyboard-hint li { margin: 5px 0; }
        .keyboard-hint kbd { background: #fff; border: 1px solid #ccc; border-radius: 3px; padding: 2px 6px; font-family: monospace; font-weight: bold; }
        
        .legend { background: #f0f0f0; padding: 15px; margin-bottom: 20px; border-radius: 6px; border-left: 4px solid #A60F2D; }
        .legend h3 { font-size: 1em; margin-bottom: 8px; color: #A60F2D; cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: space-between; }
        .legend h3:hover { color: #8a0c24; }
        .legend h3::after { content: '▼'; font-size: 0.8em; transition: transform 0.3s ease; }
        .legend h3.collapsed::after { transform: rotate(-90deg); }
        .legend-content { transition: all 0.3s ease; overflow: hidden; }
        .legend-content.hidden { max-height: 0; opacity: 0; margin: 0; }
        .legend-section { margin-bottom: 20px; }
        .legend-section:last-child { margin-bottom: 0; }
        .legend-section h4 { font-size: 1em; margin-bottom: 10px; color: #333; }
        .legend-items { display: flex; flex-wrap: wrap; gap: 20px; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-box { width: 30px; height: 30px; border-radius: 4px; border: 3px solid; }
        .legend-box.engineering { background: #8fc9f7; border-color: #1565c0; }
        .legend-box.science { background: #a5d6a7; border-color: #2e7d32; }
        .legend-box.ucore { background: #ce93d8; border-color: #6a1b9a; }
        .legend-box.technical { background: #bdbdbd; border-color: #616161; }
        .legend-label { font-size: 0.9em; font-weight: 500; }
        
        .scroll-indicators { display: flex; justify-content: center; gap: 8px; margin-top: 15px; padding: 10px; }
        .scroll-dot { width: 10px; height: 10px; border-radius: 50%; background: #ccc; cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent; }
        .scroll-dot:hover { background: #999; }
        .scroll-dot:focus { 
            outline: 3px solid #A60F2D; 
            outline-offset: 3px;
            background: #999;
        }
        .scroll-dot.active { background: #A60F2D; width: 12px; height: 12px; border-color: #8a0c24; }
        .scroll-dot.out-of-view { background: #888; opacity: 0.5; border: 2px solid #555; }
        .scroll-hint { text-align: center; color: #666; font-size: 0.9em; margin-top: 10px; padding: 8px; background: #f9f9f9; border-radius: 4px; }
        
        @media (max-width: 768px) {
            .scroll-hint { font-size: 0.85em; }
        }
        
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
            .course:hover { transform: none; }
            .scroll-dot { transition: none; }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <header role="banner">
        <h1>Washington State University</h1>
        <p class="subtitle">Voiland School of Chemical Engineering and Bioengineering</p>
        <p class="subtitle" id="programTitle">Bachelor of Science - Chemical Engineering (4 Year Plan)</p>
        <div class="program-selector">
            <label for="programSelect">Select Program:</label>
            <select id="programSelect" onchange="switchProgram()" aria-label="Select degree program">
                <option value="CHE">Chemical Engineering</option>
                <option value="BIOENG-BMSE">Bioengineering: Biomedical Systems</option>
                <option value="BIOENG-CMBE">Bioengineering: Cellular/Molecular Bioengineering</option>
                <option value="BIOENG-PREMED-BMSE">Bioengineering: Pre-Med Biomedical Systems</option>
                <option value="BIOENG-PREMED-CMBE">Bioengineering: Pre-Med Cellular/Molecular</option>
            </select>
        </div>
    </header>
    
    <main role="main" id="main-content">
        <div id="announcements" style="position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;" aria-live="polite" aria-atomic="true"></div>
        
        <div class="legend">
            <h3 id="legendToggle" class="collapsed" onclick="toggleLegend()">📊 Legend</h3>

            <div class="legend-content hidden" id="legendContent">
            <div class="legend-section">
                <h4>Course Types:</h4>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-box engineering"></div>
                        <span class="legend-label">Engineering</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box science"></div>
                        <span class="legend-label">Science/Math</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box ucore"></div>
                        <span class="legend-label">UCORE</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box technical"></div>
                        <span class="legend-label">Technical Elective</span>
                    </div>
                </div>
            </div>
            
            <div class="legend-section">
                <h4>Course Relationships (click any course to see):</h4>
                <div class="legend-items">
                    <div class="legend-item">
                        <div style="width: 32px; height: 32px; border: 5px solid #000; background: #fff; box-shadow: 0 0 0 3px #A60F2D; border-radius: 4px;"></div>
                        <span class="legend-label">Selected Course</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 32px; height: 32px; border: 5px solid #ff9800; background: #fff3e0; box-shadow: 0 0 10px rgba(255, 152, 0, 0.6); border-radius: 4px;"></div>
                        <span class="legend-label">Prerequisites (must take first)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 32px; height: 32px; border: 5px solid #2196f3; background: #e3f2fd; box-shadow: 0 0 10px rgba(33, 150, 243, 0.6); border-radius: 4px;"></div>
                        <span class="legend-label">Co-requisites (take together)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 32px; height: 32px; border: 5px solid #4caf50; background: #e8f5e9; box-shadow: 0 0 10px rgba(76, 175, 80, 0.6); border-radius: 4px;"></div>
                        <span class="legend-label">Leads to (unlocks these courses)</span>
                    </div>
                </div>
            </div>
            
            <div class="legend-section">
                <h4>Additional Indicators:</h4>
                <div class="legend-items">
                    <div class="legend-item">
                        <div style="width: 32px; height: 32px; border: 3px solid #ddd; background: #f5f5f5; border-radius: 4px; position: relative;">
                            <div style="position: absolute; top: -8px; left: -8px; background: #757575; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.7em; font-weight: bold; border: 2px solid white;">i</div>
                        </div>
                        <span class="legend-label">Course has notes (click to view)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 32px; height: 32px; border: 3px solid #ddd; background: #f5f5f5; border-radius: 4px; position: relative;">
                            <div style="position: absolute; bottom: -8px; left: -8px; background: #616161; color: white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 0.65em; font-weight: bold; border: 2px solid white;">OR</div>
                        </div>
                        <span class="legend-label">Course has alternatives (click to view)</span>
                    </div>
                </div>
            </div>
            </div>
        </div>

        <div class="keyboard-hint">
            <h3 id="keyboardToggle" class="collapsed" onclick="toggleKeyboardHint()">⌨️ Keyboard Navigation</h3>
            <ul id="keyboardList" class="hidden">
                <li><kbd>Tab</kbd> - Navigate between courses and buttons</li>
                <li><kbd>Enter</kbd> or <kbd>Space</kbd> - Select course to view prerequisites</li>
                <li><kbd>I</kbd> - View notes for the focused course (if it has notes)</li>
                <li><kbd>A</kbd> - View alternatives for the focused course (if it has alternatives)</li>
                <li><kbd>Arrow Keys</kbd> - Move between courses in the grid</li>
                <li><kbd>Escape</kbd> - Close tooltips or clear selection</li>
                <li><kbd>V</kbd> - Toggle visual/text views</li>
            </ul>
        </div>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <button id="toggleBtn" onclick="toggleView()" style="padding: 12px 24px; font-size: 1em; font-weight: bold; background: #A60F2D; color: white; border: 2px solid #A60F2D; border-radius: 6px; cursor: pointer;">
                Switch to Text-Only View
            </button>
        </div>
        
        <div class="diagram-wrapper" id="visualView">
            <svg id="connectionsSvg" aria-hidden="true" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50;"></svg>
            <div class="diagram-container" id="flowchartContainer"></div>
        </div>
        <div class="scroll-controls">
            <div class="scroll-indicators">
                <div id="scrollIndicators"></div>
            </div>
            <div class="scroll-hint">💡 Swipe or scroll horizontally to view all semesters • Click dots to jump to a semester</div>
        </div>
        
        <div id="textView" style="display: none; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h2 style="color: #A60F2D; margin-bottom: 20px;">Text-Based Course Listing</h2>
            <div id="textContent"></div>
        </div>
        
        <!-- Notes tooltip -->
        <div id="notesTooltip" class="notes-tooltip" role="tooltip" aria-live="polite">
            <button class="notes-tooltip-close" onclick="closeNotesTooltip()" aria-label="Close notes">✕</button>
            <div class="notes-tooltip-header" id="tooltipHeader"></div>
            <div class="notes-tooltip-content" id="tooltipContent"></div>
        </div>

        <!-- Alternatives tooltip -->
        <div id="alternativesTooltip" class="notes-tooltip alternatives-tooltip" role="tooltip" aria-live="polite">
            <button class="notes-tooltip-close" onclick="closeAlternativesTooltip()" aria-label="Close alternatives">✕</button>
            <div class="notes-tooltip-header" id="alternativesHeader"></div>
            <div class="notes-tooltip-content" id="alternativesContent"></div>
        </div>
    </main>

    <script>
        // Master data structure containing all programs
        const programsData = {
            'CHE': {
                name: 'Chemical Engineering',
                fullTitle: 'Bachelor of Science - Chemical Engineering (4 Year Plan)',
                courseData: {
            'CHE-101': { code: 'CHE 101', name: 'Overview of Chemical Engineering', shortName: 'CHE Overview', credits: 1, type: 'engineering', semester: 'Year 1 Fall', prereqs: [], coreqs: [], alternatives: [], notes: '' },
            'CHEM-105': { code: 'CHEM 105', name: 'Principles of Chemistry I [PSCI]', shortName: 'Gen Chem I (PSCI)', credits: 4, type: 'science', semester: 'Year 1 Fall', prereqs: [], coreqs: ['MATH-171'], alternatives: ['CHEM 115 - Honors General Chemistry I [PSCI]. Prereqs: Admitted to Honors College; MATH 171 or concurrent enrollment.'], notes: '' },
            'MATH-171': { code: 'MATH 171', name: 'Calculus I [QUAN]', shortName: 'Calc I (QUAN)', credits: 4, type: 'science', semester: 'Year 1 Fall', prereqs: [], coreqs: [], alternatives: [], notes: '' },
            'ENGL-101': { code: 'ENGL 101', name: 'College Composition [WRTG]', shortName: 'Composition (WRTG)', credits: 3, type: 'ucore', semester: 'Year 1 Fall', prereqs: [], coreqs: [], alternatives: [], notes: '' },
            'HIST-105': { code: 'HIST 105', name: 'The Roots of Contemporary Issues [ROOT]', shortName: 'Contemp Issues (ROOT)', credits: 3, type: 'ucore', semester: 'Year 1 Fall', prereqs: [], coreqs: [], alternatives: ['HIST 305 - Roots of Contemporary Issues For Transfer Students [ROOT]. No prerequisites.'], notes: '' },

            'CHE-110': { code: 'CHE 110', name: 'Introduction to Chemical Engineering', shortName: 'Intro to CHE', credits: 2, type: 'engineering', semester: 'Year 1 Spring', prereqs: ['CHE-101', 'MATH-171'], coreqs: ['CHEM-105'], alternatives: [], notes: '' },
            'CHEM-106': { code: 'CHEM 106', name: 'Principles of Chemistry II', shortName: 'Gen Chem II', credits: 4, type: 'science', semester: 'Year 1 Spring', prereqs: ['CHEM-105'], coreqs: [], alternatives: ['CHEM 116 - Honors General Chemistry II. Prereqs: CHEM 105 with C or better; admitted to Honors College.'], notes: '' },
            'BIOLOGY-107': { code: 'BIOLOGY 107', name: 'Introductory Biology: Cell Biology and Genetics [BSCI]', shortName: 'Cell Bio & Gen (BSCI)', credits: 4, type: 'science', semester: 'Year 1 Spring', prereqs: [], coreqs: [], alternatives: [], notes: '' },
            'MATH-172': { code: 'MATH 172', name: 'Calculus II', shortName: 'Calc II', credits: 4, type: 'science', semester: 'Year 1 Spring', prereqs: ['MATH-171'], coreqs: [], alternatives: ['MATH 182 - Honors Calculus II. Prereqs: MATH 171 with C or better; admitted to Honors College.'], notes: '' },
            'ELEC-INQ-1': { code: 'Elective', name: 'Elective [INQUIRY]', shortName: '(INQUIRY)', credits: 3, type: 'ucore', semester: 'Year 1 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'Must complete 3 of these 4 UCORE designations: ARTS, DIVR, EQJS, HUM. Reference the UCORE Inquiry course list: https://ucore.wsu.edu/faculty/curriculum/inquiry/' },

            'CHE-201': { code: 'CHE 201', name: 'Chemical Process Principles and Calculations', shortName: 'Process Princ', credits: 3, type: 'engineering', semester: 'Year 2 Fall', prereqs: ['CHE-110', 'CHEM-106', 'MATH-172'], coreqs: [], alternatives: [], notes: 'Prerequisite: CHE 110 or Junior standing.' },
            'CHEM-345': { code: 'CHEM 345', name: 'Organic Chemistry I', shortName: 'Org Chem I', credits: 4, type: 'science', semester: 'Year 2 Fall', prereqs: ['CHEM-106'], coreqs: [], alternatives: [], notes: '' },
            'PHYS-201': { code: 'PHYS 201', name: 'Physics for Scientists and Engineers I [PSCI]', shortName: 'Physics I (PSCI)', credits: 3, type: 'science', semester: 'Year 2 Fall', prereqs: ['MATH-171'], coreqs: ['PHYS-211'], alternatives: ['PHYS 205 - Honors Physics I [PSCI]. 5 credits. Prereqs: MATH 171 with C or better; admitted to Honors College.'], notes: '' },
            'PHYS-211': { code: 'PHYS 211', name: 'Physics Lab for Scientists and Engineers [PSCI]', shortName: 'Phys Lab I (PSCI)', credits: 1, type: 'science', semester: 'Year 2 Fall', prereqs: [], coreqs: ['PHYS-201'], alternatives: [], notes: '' },
            'MATH-273': { code: 'MATH 273', name: 'Calculus III', shortName: 'Calc III', credits: 2, type: 'science', semester: 'Year 2 Fall', prereqs: ['MATH-172'], coreqs: [], alternatives: ['MATH 283 - Honors Calculus III. Prereqs: MATH 172 with C or better; admitted to Honors College.'], notes: '' },
            'ELEC-INQ-2': { code: 'Elective', name: 'Elective [INQUIRY]', shortName: '(INQUIRY)', credits: 3, type: 'ucore', semester: 'Year 2 Fall', prereqs: [], coreqs: [], alternatives: [], notes: 'Must complete 3 of these 4 UCORE designations: ARTS, DIVR, EQJS, HUM. Reference the UCORE Inquiry course list: https://ucore.wsu.edu/faculty/curriculum/inquiry/' },

            'CHE-211': { code: 'CHE 211', name: 'Process Simulation', shortName: 'Proc Sim', credits: 3, type: 'engineering', semester: 'Year 2 Spring', prereqs: ['CHE-201'], coreqs: ['MATH-315'], alternatives: [], notes: '' },
            'CHEM-348': { code: 'CHEM 348', name: 'Organic Chemistry II and Problem Solving', shortName: 'Org Chem II', credits: 4, type: 'science', semester: 'Year 2 Spring', prereqs: ['CHEM-345'], coreqs: [], alternatives: ['MBIOS 303 - Introductory Biochemistry. Prereqs: BIOLOGY 107 with C or better; CHEM 102 or 345 with C or better.'], notes: '' },
            'PHYS-202': { code: 'PHYS 202', name: 'Physics for Scientists and Engineers II', shortName: 'Physics II', credits: 3, type: 'science', semester: 'Year 2 Spring', prereqs: ['PHYS-201'], coreqs: ['PHYS-212'], alternatives: ['PHYS 206 - Honors Physics II. 5 credits. Prereqs: PHYS 201 or 205 with C or better; admitted to Honors College.'], notes: '' },
            'PHYS-212': { code: 'PHYS 212', name: 'Physics Lab for Scientists and Engineers II', shortName: 'Phys Lab II', credits: 1, type: 'science', semester: 'Year 2 Spring', prereqs: ['PHYS-211'], coreqs: ['PHYS-202'], alternatives: [], notes: '' },
            'MATH-220': { code: 'MATH 220', name: 'Introductory Linear Algebra', shortName: 'Linear Alg', credits: 2, type: 'science', semester: 'Year 2 Spring', prereqs: ['MATH-172'], coreqs: [], alternatives: ['MATH 230 - Matrices and Linear Algebra. 3 credits. Prereqs: MATH 172 with C or better.'], notes: '' },
            'MATH-315': { code: 'MATH 315', name: 'Differential Equations', shortName: 'Diff Eq', credits: 3, type: 'science', semester: 'Year 2 Spring', prereqs: ['MATH-273'], coreqs: ['MATH-220'], alternatives: [], notes: '' },

            'CHE-301': { code: 'CHE 301', name: 'Chemical Engineering Thermodynamics', shortName: 'Thermo I', credits: 3, type: 'engineering', semester: 'Year 3 Fall', prereqs: ['CHE-101', 'PHYS-202', 'PHYS-212'], coreqs: ['CHE-211', 'CHEM-345'], alternatives: [], notes: '' },
            'CHE-310': { code: 'CHE 310', name: 'Introduction to Transport Processes', shortName: 'Transport', credits: 3, type: 'engineering', semester: 'Year 3 Fall', prereqs: ['CHE-201'], coreqs: ['CHE-211', 'MATH-315'], alternatives: [], notes: '' },
            'CHE-498': { code: 'CHE 498', name: 'Seminar', shortName: 'Seminar', credits: 1, type: 'engineering', semester: 'Year 3 Fall', prereqs: [], coreqs: [], alternatives: [], notes: '' },
            'ENGL-402': { code: 'ENGL 402', name: 'Technical and Professional Writing [M] [WRTG]', shortName: 'Tech Writing [M]', credits: 3, type: 'ucore', semester: 'Year 3 Fall', prereqs: ['ENGL-101'], coreqs: [], alternatives: ['ENGL 403 - Technical and Professional Writing ESL. Prereqs: ENGLISH 101 or 105; junior standing; pass University Writing Portfolio.'], notes: '' },
            'ELEC-TECH-1': { code: 'Elective', name: 'Technical Elective', shortName: 'Technical', credits: 3, type: 'technical', semester: 'Year 3 Fall', prereqs: [], coreqs: [], alternatives: [], notes: 'MSE 201 or any 300-400-level BIO ENG, CHEM, CHE, CE, E E, ENGR, MATH, ME, MSE, PHYSICS, or STAT course as approved by advisor.' },
            'ELEC-INQ-3': { code: 'Elective', name: 'Elective [INQUIRY]', shortName: '(INQUIRY)', credits: 3, type: 'ucore', semester: 'Year 3 Fall', prereqs: [], coreqs: [], alternatives: [], notes: 'Must complete 3 of these 4 UCORE designations: ARTS, DIVR, EQJS, HUM. Reference the UCORE Inquiry course list: https://ucore.wsu.edu/faculty/curriculum/inquiry/' },

            'CHE-302': { code: 'CHE 302', name: 'Chemical Engineering Thermodynamics II', shortName: 'Thermo II', credits: 3, type: 'engineering', semester: 'Year 3 Spring', prereqs: ['CHE-301'], coreqs: [], alternatives: [], notes: '' },
            'CHE-321': { code: 'CHE 321', name: 'Kinetics and Reactor Design', shortName: 'Kinetics', credits: 3, type: 'engineering', semester: 'Year 3 Spring', prereqs: ['CHE-211', 'CHE-310'], coreqs: ['CHE-302'], alternatives: [], notes: '' },
            'CHE-332': { code: 'CHE 332', name: 'Fluid Mechanics and Heat Transfer', shortName: 'Fluids/Heat', credits: 3, type: 'engineering', semester: 'Year 3 Spring', prereqs: ['CHE-211', 'CHE-310'], coreqs: ['CHE-302'], alternatives: [], notes: '' },
            'CHE-334': { code: 'CHE 334', name: 'Chemical Engineering Separations', shortName: 'Separations', credits: 3, type: 'engineering', semester: 'Year 3 Spring', prereqs: ['CHE-211', 'CHE-310', 'CHEM-345'], coreqs: ['CHE-302'], alternatives: [], notes: '' },

            'CHE-432': { code: 'CHE 432', name: 'Chemical Engineering Lab I [M]', shortName: 'Lab I [M]', credits: 3, type: 'engineering', semester: 'Year 4 Fall', prereqs: ['CHE-302', 'CHE-321', 'CHE-332', 'CHE-334'], coreqs: ['CHE-352', 'ENGL-402'], alternatives: [], notes: 'This course requires significant lab time. Plan your schedule accordingly and expect 6-8 hours of lab work per week in addition to lecture time.' },
            'CHE-441': { code: 'CHE 441', name: 'Process Control', shortName: 'Proc Control', credits: 3, type: 'engineering', semester: 'Year 4 Fall', prereqs: ['CHE-302', 'CHE-321', 'CHE-332', 'CHE-334'], coreqs: [], alternatives: [], notes: '' },
            'CHE-450': { code: 'CHE 450', name: 'Chemical Process Analysis and Design I', shortName: 'Design I', credits: 3, type: 'engineering', semester: 'Year 4 Fall', prereqs: ['CHE-302', 'CHE-321', 'CHE-332', 'CHE-334'], coreqs: ['CHE-352', 'ENGL-402'], alternatives: [], notes: '' },
            'CHE-352': { code: 'CHE 352', name: 'Chemical Process Safety', shortName: 'Proc Safety', credits: 3, type: 'engineering', semester: 'Year 4 Fall', prereqs: ['CHE-321', 'CHE-332'], coreqs: [], alternatives: [], notes: '' },
            'ECONS-101': { code: 'ECONS 101', name: 'Fundamentals of Microeconomics [SSCI]', shortName: 'Microecon (SSCI)', credits: 3, type: 'ucore', semester: 'Year 4 Fall', prereqs: [], coreqs: [], alternatives: ['ECONS 102 - Fundamentals of Macroeconomics [SSCI]. Prereqs: MATH 101, MATH 103 or higher, or concurrent enrollment; or minimum ALEKS score of 40%.', 'ECONS 198 - Economics Honors. Prereqs: Admitted to Honors College.'], notes: '' },

            'CHE-433': { code: 'CHE 433', name: 'Chemical Engineering Lab II [M]', shortName: 'Lab II [M]', credits: 2, type: 'engineering', semester: 'Year 4 Spring', prereqs: ['CHE-432'], coreqs: [], alternatives: [], notes: '' },
            'CHE-451': { code: 'CHE 451', name: 'Chemical Process Analysis and Design II [M]', shortName: 'Design II [M]', credits: 3, type: 'engineering', semester: 'Year 4 Spring', prereqs: ['CHE-450'], coreqs: [], alternatives: [], notes: '' },
            'ELEC-CHE-1': { code: 'Elective', name: 'Chemical Engineering Elective', shortName: 'CHE Elec', credits: 3, type: 'engineering', semester: 'Year 4 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'Any 400-level CHE course not used to fulfill major requirements. A maximum of 3 credits is allowed in CHE 488, 495, and 499 combined.' },
            'ELEC-CHE-2': { code: 'Elective', name: 'Chemical Engineering Elective', shortName: 'CHE Elec', credits: 3, type: 'engineering', semester: 'Year 4 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'Any 400-level CHE course not used to fulfill major requirements. A maximum of 3 credits is allowed in CHE 488, 495, and 499 combined.' },
            'ELEC-TECH-2': { code: 'Elective', name: 'Technical Elective', shortName: 'Technical', credits: 3, type: 'technical', semester: 'Year 4 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'MSE 201 or any 300-400-level BIO ENG, CHEM, CHE, CE, E E, ENGR, MATH, ME, MSE, PHYSICS, or STAT course as approved by advisor.' }
                },
                semesterOrder: [
                    'Year 1 Fall', 'Year 1 Spring',
                    'Year 2 Fall', 'Year 2 Spring',
                    'Year 3 Fall', 'Year 3 Spring',
                    'Year 4 Fall', 'Year 4 Spring'
                ]
            },
            'BIOENG-BMSE': {
                name: 'Bioengineering: Biomedical Systems',
                fullTitle: 'Bachelor of Science - Bioengineering: Biomedical Systems (4 Year Plan)',
                courseData: {
                    'BIOENG-140': { code: 'BIO ENG 140', name: 'Introduction to Bioengineering', shortName: 'Intro to BIOENG', credits: 1, type: 'engineering', semester: 'Year 1 Fall', prereqs: [], coreqs: [], alternatives: [], notes: '' },
                    'CHEM-105': { code: 'CHEM 105', name: 'Principles of Chemistry I [PSCI]', shortName: 'Gen Chem I (PSCI)', credits: 4, type: 'science', semester: 'Year 1 Fall', prereqs: [], coreqs: [], alternatives: ['CHEM 115 - Honors General Chemistry I [PSCI]. Prereqs: Admitted to Honors College; MATH 171 or concurrent enrollment.'], notes: '' },
                    'ENGR-120': { code: 'ENGR 120', name: 'Introduction to Engineering and Design', shortName: 'Intro to ENGR', credits: 2, type: 'engineering', semester: 'Year 1 Fall', prereqs: [], coreqs: [], alternatives: [], notes: '' },
                    'HIST-105': { code: 'HIST 105', name: 'The Roots of Contemporary Issues [ROOT]', shortName: 'Contemp Issues (ROOT)', credits: 3, type: 'ucore', semester: 'Year 1 Fall', prereqs: [], coreqs: [], alternatives: ['HIST 305 - Roots of Contemporary Issues For Transfer Students [ROOT]. No prerequisites.'], notes: '' },
                    'MATH-171': { code: 'MATH 171', name: 'Calculus I [QUAN]', shortName: 'Calc I (QUAN)', credits: 4, type: 'science', semester: 'Year 1 Fall', prereqs: [], coreqs: [], alternatives: [], notes: '' },

                    'BIOLOGY-107': { code: 'BIOLOGY 107', name: 'Introductory Biology: Cell Biology and Genetics [BSCI]', shortName: 'Cell Bio & Gen (BSCI)', credits: 4, type: 'science', semester: 'Year 1 Spring', prereqs: [], coreqs: [], alternatives: [], notes: '' },
                    'CHEM-106': { code: 'CHEM 106', name: 'Principles of Chemistry II', shortName: 'Gen Chem II', credits: 4, type: 'science', semester: 'Year 1 Spring', prereqs: ['CHEM-105'], coreqs: [], alternatives: ['CHEM 116 - Honors General Chemistry II. Prereqs: CHEM 105 with C or better; admitted to Honors College.'], notes: '' },
                    'ENGL-101': { code: 'ENGL 101', name: 'College Composition [WRTG]', shortName: 'Composition (WRTG)', credits: 3, type: 'ucore', semester: 'Year 1 Spring', prereqs: [], coreqs: [], alternatives: [], notes: '' },
                    'MATH-172': { code: 'MATH 172', name: 'Calculus II', shortName: 'Calc II', credits: 4, type: 'science', semester: 'Year 1 Spring', prereqs: ['MATH-171'], coreqs: [], alternatives: ['MATH 182 - Honors Calculus II. Prereqs: MATH 171 with C or better; admitted to Honors College.'], notes: '' },

                    'CHE-201': { code: 'CHE 201', name: 'Chemical Process Principles and Calculations', shortName: 'Process Princ', credits: 3, type: 'engineering', semester: 'Year 2 Fall', prereqs: ['BIOENG-140', 'CHEM-106', 'MATH-172'], coreqs: [], alternatives: [], notes: 'Prerequisite: BIO ENG 140 or Junior standing.' },
                    'CHEM-345': { code: 'CHEM 345', name: 'Organic Chemistry I', shortName: 'Org Chem I', credits: 4, type: 'science', semester: 'Year 2 Fall', prereqs: ['CHEM-106'], coreqs: [], alternatives: [], notes: '' },
                    'MATH-220': { code: 'MATH 220', name: 'Introductory Linear Algebra', shortName: 'Linear Alg', credits: 2, type: 'science', semester: 'Year 2 Fall', prereqs: ['MATH-172'], coreqs: [], alternatives: ['MATH 230 - Matrices and Linear Algebra. 3 credits. Prereqs: MATH 172 with C or better.'], notes: '' },
                    'MATH-273': { code: 'MATH 273', name: 'Calculus III', shortName: 'Calc III', credits: 2, type: 'science', semester: 'Year 2 Fall', prereqs: ['MATH-172'], coreqs: [], alternatives: ['MATH 283 - Honors Calculus III. Prereqs: MATH 172 with C or better; admitted to Honors College.'], notes: '' },
                    'PHYS-201': { code: 'PHYS 201', name: 'Physics for Scientists and Engineers I', shortName: 'Physics I', credits: 4, type: 'science', semester: 'Year 2 Fall', prereqs: ['MATH-171'], coreqs: ['PHYS-211'], alternatives: ['PHYS 205 - Honors Physics I. 5 credits. Prereqs: MATH 171 with C or better; admitted to Honors College.'], notes: '' },
                    'PHYS-211': { code: 'PHYS 211', name: 'Physics Lab for Scientists and Engineers I', shortName: 'Phys Lab I', credits: 1, type: 'science', semester: 'Year 2 Fall', prereqs: [], coreqs: ['PHYS-201'], alternatives: [], notes: '' },

                    'BIOENG-210': { code: 'BIO ENG 210', name: 'Bioengineering Problem Solving', shortName: 'BIOENG Prob Solving', credits: 3, type: 'engineering', semester: 'Year 2 Spring', prereqs: ['CHE-201'], coreqs: ['MATH-315'], alternatives: [], notes: '' },
                    'MATH-315': { code: 'MATH 315', name: 'Differential Equations', shortName: 'Diff Eq', credits: 3, type: 'science', semester: 'Year 2 Spring', prereqs: ['MATH-273'], coreqs: ['MATH-220'], alternatives: [], notes: '' },
                    'MBIOS-303': { code: 'MBIOS 303', name: 'Introductory Biochemistry', shortName: 'Biochem', credits: 4, type: 'science', semester: 'Year 2 Spring', prereqs: ['BIOLOGY-107', 'CHEM-345'], coreqs: [], alternatives: [], notes: '' },
                    'PHYS-202': { code: 'PHYS 202', name: 'Physics for Scientists and Engineers II', shortName: 'Physics II', credits: 4, type: 'science', semester: 'Year 2 Spring', prereqs: ['PHYS-201'], coreqs: ['PHYS-212'], alternatives: ['PHYS 206 - Honors Physics II. 5 credits. Prereqs: PHYS 201 or 205 with C or better; admitted to Honors College.'], notes: '' },
                    'PHYS-212': { code: 'PHYS 212', name: 'Physics Lab for Scientists and Engineers II', shortName: 'Phys Lab II', credits: 1, type: 'science', semester: 'Year 2 Spring', prereqs: ['PHYS-211'], coreqs: ['PHYS-202'], alternatives: [], notes: '' },
                    'ELEC-INQ-1': { code: 'Elective', name: 'Elective [INQUIRY]', shortName: '(INQUIRY)', credits: 3, type: 'ucore', semester: 'Year 2 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'Must complete 3 of these 4 UCORE designations: ARTS, DIVR, EQJS, HUM. Reference the UCORE Inquiry course list: https://ucore.wsu.edu/faculty/curriculum/inquiry/' },

                    'BIOENG-310': { code: 'BIO ENG 310', name: 'Bioengineering Transport Phenomena', shortName: 'Transport Phenom', credits: 3, type: 'engineering', semester: 'Year 3 Fall', prereqs: ['CHE-201', 'MATH-315'], coreqs: ['BIOENG-210'], alternatives: [], notes: '' },
                    'BIOENG-315': { code: 'BIO ENG 315', name: 'Thermodynamics and Kinetics in Biological Systems', shortName: 'Thermo & Kinetics', credits: 3, type: 'engineering', semester: 'Year 3 Fall', prereqs: ['CHE-201'], coreqs: ['BIOENG-210'], alternatives: [], notes: '' },
                    'BIOENG-325': { code: 'BIO ENG 325', name: 'Introduction to Bioengineering Research and Clinical Instrumentation [M]', shortName: 'Research & Instrum [M]', credits: 2, type: 'engineering', semester: 'Year 3 Fall', prereqs: ['MATH-315', 'PHYS-202', 'PHYS-212'], coreqs: ['MBIOS-303'], alternatives: [], notes: '' },
                    'CE-211': { code: 'C E 211', name: 'Statics', shortName: 'Statics', credits: 3, type: 'engineering', semester: 'Year 3 Fall', prereqs: [], coreqs: ['MATH-172', 'PHYS-201'], alternatives: [], notes: '' },
                    'STAT-370': { code: 'STAT 370', name: 'Introductory Statistics for Engineers', shortName: 'Stats', credits: 3, type: 'science', semester: 'Year 3 Fall', prereqs: ['MATH-172'], coreqs: [], alternatives: ['STAT 423 - Statistical Methods for Engineers and Scientists. Prereqs: MATH 172 with C or better.'], notes: '' },

                    'BIOENG-305': { code: 'BIO ENG 305', name: 'Bioengineering Ethics and Professional Development', shortName: 'Ethics & Prof Dev', credits: 3, type: 'engineering', semester: 'Year 3 Spring', prereqs: [], coreqs: [], alternatives: [], notes: '' },
                    'BIOENG-350': { code: 'BIO ENG 350', name: 'Introduction to Cellular Bioengineering', shortName: 'Cellular BIOENG', credits: 3, type: 'engineering', semester: 'Year 3 Spring', prereqs: ['BIOENG-315', 'BIOENG-325'], coreqs: [], alternatives: [], notes: '' },
                    'BIOENG-360': { code: 'BIO ENG 360', name: 'Quantitative Physiology', shortName: 'Quant Physio', credits: 3, type: 'engineering', semester: 'Year 3 Spring', prereqs: ['BIOENG-310'], coreqs: [], alternatives: [], notes: '' },
                    'ELEC-COMM': { code: 'Elective', name: 'Communication or Writing Elective', shortName: '[COMM]/[WRTG]', credits: 3, type: 'ucore', semester: 'Year 3 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'Choose a UCORE [COMM] or [WRTG] course.<br><br>[COMM] course list:<br>https://ucore.wsu.edu/students/courses-and-learning-outcomes/comm/<br><br>[WRTG] course list:<br>https://ucore.wsu.edu/students/courses-and-learning-outcomes/wrtg/' },
                    'EE-261': { code: 'E E 261', name: 'Electrical Circuits I', shortName: 'Circuits I', credits: 3, type: 'engineering', semester: 'Year 3 Spring', prereqs: ['PHYS-202', 'PHYS-212'], coreqs: ['MATH-315'], alternatives: [], notes: '' },

                    'BIOENG-410': { code: 'BIO ENG 410', name: 'Bioengineering Capstone Project I', shortName: 'Capstone I', credits: 3, type: 'engineering', semester: 'Year 4 Fall', prereqs: ['BIOENG-305', 'BIOENG-350', 'BIOENG-360'], coreqs: ['BIOENG-420', 'BIOENG-430'], alternatives: [], notes: '' },
                    'BIOENG-420': { code: 'BIO ENG 420', name: 'Mechanics of Biological Materials', shortName: 'Bio Mechanics', credits: 3, type: 'engineering', semester: 'Year 4 Fall', prereqs: ['CE-211'], coreqs: [], alternatives: [], notes: 'Requires senior standing.' },
                    'BIOENG-430': { code: 'BIO ENG 430', name: 'Bioinstrumentation', shortName: 'Bioinstrument', credits: 3, type: 'engineering', semester: 'Year 4 Fall', prereqs: ['EE-261', 'BIOENG-325'], coreqs: [], alternatives: [], notes: '' },
                    'ECONS-101': { code: 'ECONS 101', name: 'Fundamentals of Microeconomics [SSCI]', shortName: 'Microecon (SSCI)', credits: 3, type: 'ucore', semester: 'Year 4 Fall', prereqs: [], coreqs: [], alternatives: ['ECONS 102 - Fundamentals of Macroeconomics [SSCI]. Prereqs: MATH 101, MATH 103 or higher, or concurrent enrollment; or minimum ALEKS score of 40%.', 'ECONS 198 - Economics Honors. Prereqs: Admitted to Honors College.'], notes: '' },
                    'ELEC-INQ-2': { code: 'Elective', name: 'Elective [INQUIRY]', shortName: '(INQUIRY)', credits: 3, type: 'ucore', semester: 'Year 4 Fall', prereqs: [], coreqs: [], alternatives: [], notes: 'Must complete 3 of these 4 UCORE designations: ARTS, DIVR, EQJS, HUM. Reference the UCORE Inquiry course list: https://ucore.wsu.edu/faculty/curriculum/inquiry/' },

                    'BIOENG-411': { code: 'BIO ENG 411', name: 'Bioengineering Capstone Project II [CAPS]', shortName: 'Capstone II [CAPS]', credits: 3, type: 'engineering', semester: 'Year 4 Spring', prereqs: ['BIOENG-410'], coreqs: [], alternatives: [], notes: '' },
                    'BIOENG-440': { code: 'BIO ENG 440', name: 'Physiological Control Systems', shortName: 'Phys Control Sys', credits: 3, type: 'engineering', semester: 'Year 4 Spring', prereqs: ['BIOENG-360'], coreqs: [], alternatives: [], notes: '' },
                    'ELEC-BIOENG': { code: 'Elective', name: 'Bioengineering Elective', shortName: 'BIOENG Elec', credits: 3, type: 'engineering', semester: 'Year 4 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'Choose from approved Bioengineering electives. Consult with advisor.' },
                    'ELEC-TECH': { code: 'Elective', name: 'Technical Elective', shortName: 'Technical', credits: 3, type: 'technical', semester: 'Year 4 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'Any 300-400 level BIO ENG, CHEM, CHE, CE, CS, E E, ENGR, MATH, ME, MSE, PHYSICS, or STAT course as approved by advisor.' },
                    'ELEC-INQ-3': { code: 'Elective', name: 'Elective [INQUIRY]', shortName: '(INQUIRY)', credits: 3, type: 'ucore', semester: 'Year 4 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'Must complete 3 of these 4 UCORE designations: ARTS, DIVR, EQJS, HUM. Reference the UCORE Inquiry course list: https://ucore.wsu.edu/faculty/curriculum/inquiry/' },
                    'EXIT-INTERVIEW': { code: 'Exit Interview', name: 'Complete BIO ENG Exit Interview', shortName: 'Exit Interview', credits: 0, type: 'engineering', semester: 'Year 4 Spring', prereqs: [], coreqs: [], alternatives: [], notes: 'Required milestone - complete the exit interview before graduation.' }
                },
                semesterOrder: [
                    'Year 1 Fall', 'Year 1 Spring',
                    'Year 2 Fall', 'Year 2 Spring',
                    'Year 3 Fall', 'Year 3 Spring',
                    'Year 4 Fall', 'Year 4 Spring'
                ]
            },
            'BIOENG-CMBE': {
                name: 'Bioengineering: Cellular/Molecular Bioengineering',
                fullTitle: 'Bachelor of Science - Bioengineering: Cellular/Molecular Bioengineering (4 Year Plan)',
                courseData: {
                    // TODO: Add BIOENG-CMBE data - placeholder for now
                },
                semesterOrder: [
                    'Year 1 Fall', 'Year 1 Spring',
                    'Year 2 Fall', 'Year 2 Spring',
                    'Year 3 Fall', 'Year 3 Spring',
                    'Year 4 Fall', 'Year 4 Spring'
                ]
            },
            'BIOENG-PREMED-BMSE': {
                name: 'Bioengineering: Pre-Med Biomedical Systems',
                fullTitle: 'Bachelor of Science - Bioengineering: Pre-Med Biomedical Systems (4 Year Plan)',
                courseData: {
                    // TODO: Add BIOENG-PREMED-BMSE data - placeholder for now
                },
                semesterOrder: [
                    'Year 1 Fall', 'Year 1 Spring',
                    'Year 2 Fall', 'Year 2 Spring',
                    'Year 3 Fall', 'Year 3 Spring',
                    'Year 4 Fall', 'Year 4 Spring'
                ]
            },
            'BIOENG-PREMED-CMBE': {
                name: 'Bioengineering: Pre-Med Cellular/Molecular',
                fullTitle: 'Bachelor of Science - Bioengineering: Pre-Med Cellular/Molecular (4 Year Plan)',
                courseData: {
                    // TODO: Add BIOENG-PREMED-CMBE data - placeholder for now
                },
                semesterOrder: [
                    'Year 1 Fall', 'Year 1 Spring',
                    'Year 2 Fall', 'Year 2 Spring',
                    'Year 3 Fall', 'Year 3 Spring',
                    'Year 4 Fall', 'Year 4 Spring'
                ]
            }
        };

        // Current program state
        let currentProgram = 'CHE';
        let courseData = programsData[currentProgram].courseData;
        let semesterOrder = programsData[currentProgram].semesterOrder;

        // Make courseData and semesterOrder available globally
        window.courseData = courseData;
        window.semesterOrder = semesterOrder;

        function buildLeadsToMap() {
            const leadsToMap = {};
            
            Object.keys(courseData).forEach(key => {
                leadsToMap[key] = { asPrereq: [], asCoreq: [] };
            });
            
            Object.entries(courseData).forEach(([courseKey, course]) => {
                course.prereqs.forEach(prereqKey => {
                    if (leadsToMap[prereqKey]) {
                        leadsToMap[prereqKey].asPrereq.push(courseKey);
                    }
                });
                
                course.coreqs.forEach(coreqKey => {
                    if (leadsToMap[coreqKey]) {
                        leadsToMap[coreqKey].asCoreq.push(courseKey);
                    }
                });
            });
            
            return leadsToMap;
        }
        
        let leadsToMap = {};
        let selectedCourseKey = null;
        let connectionCounts = {};
        let sourceConnectionCounts = {};
        let currentNotesIndicator = null;
        
        function showNotesTooltip(courseKey, event, indicatorElement) {
            event.stopPropagation();

            // Close any open tooltips first
            closeAlternativesTooltip();

            const course = courseData[courseKey];
            if (!course || !course.notes || course.notes.trim() === '') return;

            const tooltip = document.getElementById('notesTooltip');
            const header = document.getElementById('tooltipHeader');
            const content = document.getElementById('tooltipContent');
            const announcer = document.getElementById('announcements');
            
            header.textContent = `${course.code} - ${course.name}`;

            // Convert URLs in notes to clickable links
            const notesWithLinks = course.notes.replace(
                /(https?:\/\/[^\s<]+)/g,
                '<a href="$1" target="_blank" rel="noopener noreferrer" style="color: #A60F2D; text-decoration: underline;">$1</a>'
            );
            content.innerHTML = notesWithLinks;
            
            const x = event.clientX;
            const y = event.clientY;
            
            tooltip.style.left = `${x + 10}px`;
            tooltip.style.top = `${y + 10}px`;
            
            tooltip.classList.add('visible');
            
            const tooltipId = 'notesTooltip';
            indicatorElement.setAttribute('aria-describedby', tooltipId);
            currentNotesIndicator = indicatorElement;
            
            if (announcer) {
                announcer.textContent = `Notes for ${course.code}: ${course.notes}`;
            }
            
            setTimeout(() => {
                const rect = tooltip.getBoundingClientRect();
                if (rect.right > window.innerWidth) {
                    tooltip.style.left = `${window.innerWidth - rect.width - 20}px`;
                }
                if (rect.bottom > window.innerHeight) {
                    tooltip.style.top = `${window.innerHeight - rect.height - 20}px`;
                }
                
                const closeBtn = tooltip.querySelector('.notes-tooltip-close');
                if (closeBtn) {
                    closeBtn.focus();
                }
            }, 0);
        }
        
        window.closeNotesTooltip = function() {
            const tooltip = document.getElementById('notesTooltip');
            tooltip.classList.remove('visible');

            if (currentNotesIndicator) {
                currentNotesIndicator.removeAttribute('aria-describedby');
                currentNotesIndicator = null;
            }
        };

        let currentAlternativesIndicator = null;

        function showAlternativesTooltip(courseKey, event, indicatorElement) {
            event.stopPropagation();

            // Close any open tooltips first
            closeNotesTooltip();

            const course = courseData[courseKey];
            if (!course || !course.alternatives || course.alternatives.length === 0) return;

            const tooltip = document.getElementById('alternativesTooltip');
            const header = document.getElementById('alternativesHeader');
            const content = document.getElementById('alternativesContent');
            const announcer = document.getElementById('announcements');

            header.textContent = `${course.code} - Alternative Courses`;

            if (course.alternatives.length === 1) {
                content.textContent = course.alternatives[0];
            } else {
                content.innerHTML = course.alternatives.map((alt, index) => {
                    return `<strong>Option ${index + 1}:</strong> ${alt}`;
                }).join('<br><br>');
            }

            const x = event.clientX;
            const y = event.clientY;

            tooltip.style.left = `${x + 10}px`;
            tooltip.style.top = `${y + 10}px`;

            tooltip.classList.add('visible');

            const tooltipId = 'alternativesTooltip';
            indicatorElement.setAttribute('aria-describedby', tooltipId);
            currentAlternativesIndicator = indicatorElement;

            if (announcer) {
                if (course.alternatives.length === 1) {
                    announcer.textContent = `Alternative course for ${course.code}: ${course.alternatives[0]}`;
                } else {
                    const altText = course.alternatives.map((alt, index) =>
                        `Option ${index + 1}: ${alt}`
                    ).join('. ');
                    announcer.textContent = `Alternative courses for ${course.code}. ${altText}`;
                }
            }

            setTimeout(() => {
                const rect = tooltip.getBoundingClientRect();
                if (rect.right > window.innerWidth) {
                    tooltip.style.left = `${window.innerWidth - rect.width - 20}px`;
                }
                if (rect.bottom > window.innerHeight) {
                    tooltip.style.top = `${window.innerHeight - rect.height - 20}px`;
                }

                const closeBtn = tooltip.querySelector('.notes-tooltip-close');
                if (closeBtn) {
                    closeBtn.focus();
                }
            }, 0);
        }

        window.closeAlternativesTooltip = function() {
            const tooltip = document.getElementById('alternativesTooltip');
            tooltip.classList.remove('visible');

            if (currentAlternativesIndicator) {
                currentAlternativesIndicator.removeAttribute('aria-describedby');
                currentAlternativesIndicator = null;
            }
        };
        
        window.clearHighlights = function() {
            document.querySelectorAll('.course').forEach(courseDiv => {
                courseDiv.classList.remove('selected', 'highlighted-prereq', 'highlighted-coreq', 'highlighted-leadsto', 'dimmed');
                courseDiv.style.border = '';
                courseDiv.style.boxShadow = '';
                courseDiv.style.opacity = '';
                courseDiv.style.filter = '';
                courseDiv.style.transform = '';
                courseDiv.style.zIndex = '';
                
                const badge = courseDiv.querySelector('.relationship-badge');
                if (badge) badge.remove();
            });
            
            const svg = document.getElementById('connectionsSvg');
            if (svg) svg.innerHTML = '';
            
            connectionCounts = {};
            sourceConnectionCounts = {};
            
            if (selectedCourseKey) {
                const announcer = document.getElementById('announcements');
                if (announcer) {
                    announcer.textContent = 'Course selection cleared.';
                }
            }
            
            selectedCourseKey = null;
        };
        
        function updateSVGSize() {
            const svg = document.getElementById('connectionsSvg');
            const container = document.getElementById('flowchartContainer');
            
            if (!svg || !container) return;
            
            svg.style.width = container.scrollWidth + 'px';
            svg.style.height = container.scrollHeight + 'px';
            svg.setAttribute('width', container.scrollWidth);
            svg.setAttribute('height', container.scrollHeight);
        }
        
        function drawConnection(fromKey, toKey, color, type, sourcePositionIndex) {
            const fromDiv = document.querySelector(`[data-course-key="${fromKey}"]`);
            const toDiv = document.querySelector(`[data-course-key="${toKey}"]`);
            const svg = document.getElementById('connectionsSvg');
            const wrapper = document.getElementById('visualView');
            const container = document.getElementById('flowchartContainer');

            if (!fromDiv || !toDiv || !svg || !wrapper || !container) return;

            const fromRect = fromDiv.getBoundingClientRect();
            const toRect = toDiv.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            const wrapperRect = wrapper.getBoundingClientRect();

            const scrollLeft = wrapper.scrollLeft;
            const scrollTop = wrapper.scrollTop;

            const fromCourse = courseData[fromKey];
            const toCourse = courseData[toKey];
            const sameSemester = fromCourse.semester === toCourse.semester;

            let fromX, fromY, toX, toY;

            if (sameSemester) {
                const fromIsAbove = fromRect.top < toRect.top;

                if (fromIsAbove) {
                    fromX = fromRect.left - wrapperRect.left + scrollLeft + fromRect.width / 2;
                    fromY = fromRect.top - wrapperRect.top + scrollTop + fromRect.height;
                    toX = toRect.left - wrapperRect.left + scrollLeft + toRect.width / 2;
                    toY = toRect.top - wrapperRect.top + scrollTop;
                } else {
                    fromX = fromRect.left - wrapperRect.left + scrollLeft + fromRect.width / 2;
                    fromY = fromRect.top - wrapperRect.top + scrollTop;
                    toX = toRect.left - wrapperRect.left + scrollLeft + toRect.width / 2;
                    toY = toRect.top - wrapperRect.top + scrollTop + toRect.height;
                }
            } else {
                if (!sourceConnectionCounts[fromKey]) {
                    sourceConnectionCounts[fromKey] = 0;
                }

                const sourceIndex = sourceConnectionCounts[fromKey];
                const totalSourceConnections = window.srcTotalConnections[fromKey] || 1;

                let sourceVerticalOffset = 0;
                if (totalSourceConnections > 1) {
                    const spacing = 15;
                    const totalSpread = (totalSourceConnections - 1) * spacing;
                    sourceVerticalOffset = (sourceIndex * spacing) - (totalSpread / 2);
                }

                sourceConnectionCounts[fromKey]++;

                // Use sourcePositionIndex to determine destination point
                // Sources with higher positions get higher destination points
                const totalConnections = window.destTotalConnections[toKey] || 1;

                let destVerticalOffset = 0;
                if (totalConnections > 1 && sourcePositionIndex !== undefined) {
                    const spacing = 15;
                    const totalSpread = (totalConnections - 1) * spacing;
                    destVerticalOffset = (sourcePositionIndex * spacing) - (totalSpread / 2);
                }

                fromX = fromRect.left - wrapperRect.left + scrollLeft + fromRect.width;
                fromY = fromRect.top - wrapperRect.top + scrollTop + fromRect.height / 2 + sourceVerticalOffset;

                toX = toRect.left - wrapperRect.left + scrollLeft;
                toY = toRect.top - wrapperRect.top + scrollTop + toRect.height / 2 + destVerticalOffset;
            }
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const d = `M ${fromX} ${fromY} L ${toX} ${toY}`;

            path.setAttribute('d', d);
            path.setAttribute('stroke', color);
            path.setAttribute('stroke-width', '3');
            path.setAttribute('fill', 'none');
            path.setAttribute('stroke-opacity', '0.7');

            svg.appendChild(path);
        }
        
        function createArrowMarkers() {
            // Arrow markers removed - not currently used
        }
        
        window.highlightRelatedCourses = function(courseKey) {
            window.clearHighlights();
            
            const course = courseData[courseKey];
            const leadsTo = leadsToMap[courseKey];
            
            if (!course || !leadsTo) return;
            
            requestAnimationFrame(() => {
                const selectedDiv = document.querySelector(`[data-course-key="${courseKey}"]`);
                if (selectedDiv) {
                    selectedDiv.classList.add('selected');
                    selectedDiv.style.border = '5px solid #000';
                    selectedDiv.style.boxShadow = '0 0 0 4px #A60F2D, 0 0 20px rgba(166, 15, 45, 0.5)';
                    selectedDiv.style.zIndex = '100';
                    selectedDiv.style.opacity = '1';
                    selectedDiv.style.filter = 'none';
                }
                
                document.querySelectorAll('.course').forEach(courseDiv => {
                    if (courseDiv.getAttribute('data-course-key') !== courseKey) {
                        courseDiv.classList.add('dimmed');
                        courseDiv.style.opacity = '0.25';
                        courseDiv.style.filter = 'grayscale(80%)';
                    }
                });
                
                course.prereqs.forEach(prereqKey => {
                    const prereqDiv = document.querySelector(`[data-course-key="${prereqKey}"]`);
                    if (prereqDiv) {
                        prereqDiv.classList.remove('dimmed');
                        prereqDiv.classList.add('highlighted-prereq');
                        prereqDiv.style.border = '5px solid #ff9800';
                        prereqDiv.style.boxShadow = '0 0 15px rgba(255, 152, 0, 0.8)';
                        prereqDiv.style.opacity = '1';
                        prereqDiv.style.filter = 'none';
                        
                        const badge = document.createElement('div');
                        badge.className = 'relationship-badge prereq';
                        badge.textContent = 'PR';
                        prereqDiv.appendChild(badge);
                    }
                });
                
                course.coreqs.forEach(coreqKey => {
                    const coreqDiv = document.querySelector(`[data-course-key="${coreqKey}"]`);
                    if (coreqDiv) {
                        coreqDiv.classList.remove('dimmed');
                        coreqDiv.classList.add('highlighted-coreq');
                        coreqDiv.style.border = '5px solid #2196f3';
                        coreqDiv.style.boxShadow = '0 0 15px rgba(33, 150, 243, 0.8)';
                        coreqDiv.style.opacity = '1';
                        coreqDiv.style.filter = 'none';
                        
                        const badge = document.createElement('div');
                        badge.className = 'relationship-badge coreq';
                        badge.textContent = 'CO';
                        coreqDiv.appendChild(badge);
                    }
                });
                
                // Filter out courses that are already shown as corequisites
                const allLeadsTo = [...leadsTo.asPrereq, ...leadsTo.asCoreq].filter(
                    key => !course.coreqs.includes(key)
                );
                allLeadsTo.forEach(leadsToKey => {
                    const leadsToDiv = document.querySelector(`[data-course-key="${leadsToKey}"]`);
                    if (leadsToDiv) {
                        leadsToDiv.classList.remove('dimmed');
                        leadsToDiv.classList.add('highlighted-leadsto');
                        leadsToDiv.style.border = '5px solid #4caf50';
                        leadsToDiv.style.boxShadow = '0 0 15px rgba(76, 175, 80, 0.8)';
                        leadsToDiv.style.opacity = '1';
                        leadsToDiv.style.filter = 'none';
                        
                        const badge = document.createElement('div');
                        badge.className = 'relationship-badge leadsto';
                        badge.textContent = '→';
                        leadsToDiv.appendChild(badge);
                    }
                });
                
                requestAnimationFrame(() => {
                    const destConnectionCounts = {};
                    const srcConnectionCounts = {};
                    
                    const prereqsSorted = [...course.prereqs].sort((a, b) => {
                        const divA = document.querySelector(`[data-course-key="${a}"]`);
                        const divB = document.querySelector(`[data-course-key="${b}"]`);
                        if (!divA || !divB) return 0;
                        return divA.getBoundingClientRect().top - divB.getBoundingClientRect().top;
                    });
                    
                    const coreqsSorted = [...course.coreqs].sort((a, b) => {
                        const divA = document.querySelector(`[data-course-key="${a}"]`);
                        const divB = document.querySelector(`[data-course-key="${b}"]`);
                        if (!divA || !divB) return 0;
                        return divA.getBoundingClientRect().top - divB.getBoundingClientRect().top;
                    });
                    
                    const allLeadsTo = [...leadsTo.asPrereq, ...leadsTo.asCoreq];
                    const leadsToSorted = allLeadsTo.sort((a, b) => {
                        const divA = document.querySelector(`[data-course-key="${a}"]`);
                        const divB = document.querySelector(`[data-course-key="${b}"]`);
                        if (!divA || !divB) return 0;
                        return divA.getBoundingClientRect().top - divB.getBoundingClientRect().top;
                    });
                    
                    prereqsSorted.forEach(prereqKey => {
                        if (!destConnectionCounts[courseKey]) destConnectionCounts[courseKey] = 0;
                        destConnectionCounts[courseKey]++;
                        
                        if (!srcConnectionCounts[prereqKey]) srcConnectionCounts[prereqKey] = 0;
                        srcConnectionCounts[prereqKey]++;
                    });
                    
                    coreqsSorted.forEach(coreqKey => {
                        if (!destConnectionCounts[courseKey]) destConnectionCounts[courseKey] = 0;
                        destConnectionCounts[courseKey]++;
                        
                        if (!srcConnectionCounts[coreqKey]) srcConnectionCounts[coreqKey] = 0;
                        srcConnectionCounts[coreqKey]++;
                    });
                    
                    leadsToSorted.forEach(leadsToKey => {
                        if (!destConnectionCounts[leadsToKey]) destConnectionCounts[leadsToKey] = 0;
                        destConnectionCounts[leadsToKey]++;
                        
                        if (!srcConnectionCounts[courseKey]) srcConnectionCounts[courseKey] = 0;
                        srcConnectionCounts[courseKey]++;
                    });
                    
                    window.destTotalConnections = destConnectionCounts;
                    window.srcTotalConnections = srcConnectionCounts;
                    
                    // Combine prereqs and coreqs with their types and calculate angles
                    const courseDiv = document.querySelector(`[data-course-key="${courseKey}"]`);
                    const courseRect = courseDiv ? courseDiv.getBoundingClientRect() : null;

                    // Filter out coreqs in same semester (they use vertical connections without offsets)
                    const coreqsDifferentSemester = coreqsSorted.filter(key => {
                        const coreqCourse = courseData[key];
                        return coreqCourse && coreqCourse.semester !== course.semester;
                    });

                    const incomingConnections = [
                        ...prereqsSorted.map(key => ({key, type: 'prereq', color: '#ff9800'})),
                        ...coreqsDifferentSemester.map(key => ({key, type: 'coreq', color: '#2196f3'}))
                    ];

                    // Calculate position and angle from each source to destination
                    incomingConnections.forEach(conn => {
                        const sourceDiv = document.querySelector(`[data-course-key="${conn.key}"]`);
                        if (sourceDiv && courseRect) {
                            const sourceRect = sourceDiv.getBoundingClientRect();
                            conn.verticalPos = sourceRect.top + sourceRect.height / 2;
                            const dx = courseRect.left - (sourceRect.left + sourceRect.width);
                            const dy = (courseRect.top + courseRect.height / 2) - (sourceRect.top + sourceRect.height / 2);
                            conn.angle = Math.atan2(dy, dx);
                        } else {
                            conn.verticalPos = 0;
                            conn.angle = 0;
                        }
                    });

                    // Sort primarily by vertical position, secondarily by angle
                    incomingConnections.sort((a, b) => {
                        const verticalDiff = a.verticalPos - b.verticalPos;
                        // If vertical positions are significantly different (>20px), use that
                        if (Math.abs(verticalDiff) > 20) {
                            return verticalDiff;
                        }
                        // Otherwise use angle to break ties
                        return a.angle - b.angle;
                    });

                    // Draw all incoming connections with continuous indexing based on angle
                    incomingConnections.forEach((conn, index) => {
                        drawConnection(conn.key, courseKey, conn.color, conn.type, index);
                    });

                    // Draw coreqs in same semester (they don't use the offset system)
                    const coreqsSameSemester = coreqsSorted.filter(key => {
                        const coreqCourse = courseData[key];
                        return coreqCourse && coreqCourse.semester === course.semester;
                    });
                    coreqsSameSemester.forEach(coreqKey => {
                        drawConnection(coreqKey, courseKey, '#2196f3', 'coreq', undefined);
                    });

                    // Calculate angles for outgoing connections
                    const outgoingConnections = leadsToSorted.map(key => ({
                        key,
                        type: 'leadsto',
                        color: '#4caf50'
                    }));

                    outgoingConnections.forEach(conn => {
                        const destDiv = document.querySelector(`[data-course-key="${conn.key}"]`);
                        if (destDiv && courseRect) {
                            const destRect = destDiv.getBoundingClientRect();
                            conn.verticalPos = destRect.top + destRect.height / 2;
                            const dx = destRect.left - (courseRect.left + courseRect.width);
                            const dy = (destRect.top + destRect.height / 2) - (courseRect.top + courseRect.height / 2);
                            conn.angle = Math.atan2(dy, dx);
                        } else {
                            conn.verticalPos = 0;
                            conn.angle = 0;
                        }
                    });

                    // Sort primarily by vertical position, secondarily by angle
                    outgoingConnections.sort((a, b) => {
                        const verticalDiff = a.verticalPos - b.verticalPos;
                        // If vertical positions are significantly different (>20px), use that
                        if (Math.abs(verticalDiff) > 20) {
                            return verticalDiff;
                        }
                        // Otherwise use angle to break ties
                        return a.angle - b.angle;
                    });

                    // Draw outgoing connections with angle-based indexing
                    outgoingConnections.forEach((conn, index) => {
                        drawConnection(courseKey, conn.key, conn.color, conn.type, index);
                    });
                    
                    announceSelection(courseKey, course, leadsToSorted);
                    
                    updateSVGSize();
                });
            });
            
            selectedCourseKey = courseKey;
        };
        
        function announceSelection(courseKey, course, leadsTo) {
            const announcer = document.getElementById('announcements');
            if (!announcer) return;
            
            const courseInfo = courseData[courseKey];
            if (!courseInfo) return;
            
            const prereqCount = course.prereqs.length;
            const coreqCount = course.coreqs.length;
            const leadsToCount = leadsTo.length;
            
            let message = `${courseInfo.code} ${courseInfo.name} selected. `;
            
            if (prereqCount === 0 && coreqCount === 0 && leadsToCount === 0) {
                message += 'This course has no prerequisites, co-requisites, or courses it leads to.';
            } else {
                const parts = [];
                
                if (prereqCount > 0) {
                    const prereqNames = course.prereqs.map(p => courseData[p]?.code || p).join(', ');
                    parts.push(`${prereqCount} prerequisite${prereqCount > 1 ? 's' : ''}: ${prereqNames}`);
                }
                
                if (coreqCount > 0) {
                    const coreqNames = course.coreqs.map(c => courseData[c]?.code || c).join(', ');
                    parts.push(`${coreqCount} co-requisite${coreqCount > 1 ? 's' : ''}: ${coreqNames}`);
                }
                
                if (leadsToCount > 0) {
                    const leadsToNames = leadsTo.map(l => courseData[l]?.code || l).join(', ');
                    parts.push(`leads to ${leadsToCount} course${leadsToCount > 1 ? 's' : ''}: ${leadsToNames}`);
                }
                
                message += parts.join('. ') + '.';
            }
            
            announcer.textContent = message;
        }
        
        function buildFlowchart() {
            const container = document.getElementById('flowchartContainer');
            
            const courseBySemester = {};
            semesterOrder.forEach(sem => courseBySemester[sem] = []);
            
            Object.entries(courseData).forEach(([key, course]) => {
                courseBySemester[course.semester].push({key, ...course});
            });
            
            function getSortPriority(courseCode) {
                if (courseCode.startsWith('CHE-')) return 1;
                if (courseCode.startsWith('BIOENG-')) return 1;
                if (courseCode.startsWith('ELEC-CHE')) return 2;
                if (courseCode.startsWith('ELEC-BIOENG')) return 2;
                if (courseCode.startsWith('ENGR-')) return 3;
                if (courseCode.startsWith('EE-')) return 3;  // Electrical Engineering
                if (courseCode.startsWith('CE-')) return 3;  // Civil Engineering
                if (courseCode.startsWith('ELEC-TECH')) return 4;
                if (courseCode.startsWith('CHEM-')) return 5;
                if (courseCode.startsWith('MBIOS-')) return 5;  // Treat MBIOS like chemistry
                if (courseCode.startsWith('MATH-')) return 6;
                if (courseCode.startsWith('PHYS-')) return 7;
                if (courseCode.startsWith('BIOLOGY-')) return 8;
                if (courseCode.startsWith('ENGL-')) return 9;
                if (courseCode.startsWith('HIST-')) return 10;
                if (courseCode.startsWith('ECONS-')) return 11;
                if (courseCode.startsWith('ELEC-')) return 12;
                if (courseCode.startsWith('STAT-')) return 13;
                return 14;
            }
            
            semesterOrder.forEach(semester => {
                courseBySemester[semester].sort((a, b) => {
                    const priorityA = getSortPriority(a.key);
                    const priorityB = getSortPriority(b.key);
                    if (priorityA !== priorityB) {
                        return priorityA - priorityB;
                    }
                    return a.key.localeCompare(b.key);
                });
            });
            
            semesterOrder.forEach(semester => {
                const column = document.createElement('div');
                column.className = 'semester-column';
                
                const header = document.createElement('div');
                header.className = 'semester-header';
                const parts = semester.split(' ');
                header.innerHTML = `${parts[0]} ${parts[1]}<br>${parts[2]}`;
                column.appendChild(header);
                
                courseBySemester[semester].forEach(course => {
                    const courseDiv = document.createElement('div');
                    courseDiv.className = `course ${course.type}`;
                    courseDiv.setAttribute('tabindex', '0');
                    courseDiv.setAttribute('data-course-key', course.key);
                    
                    const prereqText = course.prereqs.length > 0
                        ? `Requires: ${course.prereqs.map(p => courseData[p]?.code || p).join(', ')}.`
                        : '';

                    const coreqText = course.coreqs.length > 0
                        ? ` With: ${course.coreqs.map(c => courseData[c]?.code || c).join(', ')}.`
                        : '';

                    const alternativesText = course.alternatives && course.alternatives.length > 0
                        ? ` Has ${course.alternatives.length} alternative course${course.alternatives.length > 1 ? 's' : ''}, press A to view.`
                        : '';

                    const ariaLabel = `${course.code}, ${course.credits} credits. ${prereqText}${coreqText}${alternativesText}`;
                    courseDiv.setAttribute('aria-label', ariaLabel);
                    
                    courseDiv.innerHTML = `
                        <span class="course-code">${course.code}</span>
                        <span class="course-name">${course.shortName || course.name}</span>
                        <span class="course-credits">${course.credits} cr</span>
                    `;
                    
                    if (course.notes && course.notes.trim() !== '') {
                        const notesIndicator = document.createElement('div');
                        notesIndicator.className = 'notes-indicator';
                        notesIndicator.textContent = 'i';
                        notesIndicator.setAttribute('aria-hidden', 'true');
                        notesIndicator.setAttribute('title', 'This course has notes - press I to view');

                        notesIndicator.addEventListener('click', (e) => {
                            e.stopPropagation();

                            // Check if clicking the same indicator to toggle off
                            const tooltip = document.getElementById('notesTooltip');
                            if (tooltip && tooltip.classList.contains('visible') && currentNotesIndicator === courseDiv) {
                                closeNotesTooltip();
                                return;
                            }

                            const rect = courseDiv.getBoundingClientRect();
                            const syntheticEvent = {
                                clientX: rect.left + rect.width / 2,
                                clientY: rect.top + rect.height / 2,
                                stopPropagation: () => {}
                            };
                            showNotesTooltip(course.key, syntheticEvent, courseDiv);
                        });

                        courseDiv.appendChild(notesIndicator);
                        courseDiv.setAttribute('data-has-notes', 'true');
                    }

                    if (course.alternatives && course.alternatives.length > 0) {
                        const alternativesIndicator = document.createElement('div');
                        alternativesIndicator.className = 'alternatives-indicator';
                        alternativesIndicator.textContent = 'OR';
                        alternativesIndicator.setAttribute('aria-hidden', 'true');
                        alternativesIndicator.setAttribute('title', `Alternative: ${course.alternatives.join(', ')}`);

                        alternativesIndicator.addEventListener('click', (e) => {
                            e.stopPropagation();

                            // Check if clicking the same indicator to toggle off
                            const tooltip = document.getElementById('alternativesTooltip');
                            if (tooltip && tooltip.classList.contains('visible') && currentAlternativesIndicator === alternativesIndicator) {
                                closeAlternativesTooltip();
                                return;
                            }

                            const rect = courseDiv.getBoundingClientRect();
                            const syntheticEvent = {
                                clientX: rect.left + rect.width / 2,
                                clientY: rect.bottom,
                                stopPropagation: () => {}
                            };
                            showAlternativesTooltip(course.key, syntheticEvent, alternativesIndicator);
                        });

                        courseDiv.appendChild(alternativesIndicator);
                        courseDiv.setAttribute('data-has-alternatives', 'true');
                    }
                    
                    courseDiv.addEventListener('click', (e) => {
                        // Close any open tooltips first
                        const notesTooltip = document.getElementById('notesTooltip');
                        const alternativesTooltip = document.getElementById('alternativesTooltip');

                        if (!e.target.closest('.notes-indicator')) {
                            if (notesTooltip && notesTooltip.classList.contains('visible')) {
                                closeNotesTooltip();
                            }
                        }

                        if (!e.target.closest('.alternatives-indicator')) {
                            if (alternativesTooltip && alternativesTooltip.classList.contains('visible')) {
                                closeAlternativesTooltip();
                            }
                        }

                        e.stopPropagation();
                        if (selectedCourseKey === course.key) {
                            window.clearHighlights();
                        } else {
                            window.highlightRelatedCourses(course.key);
                        }
                    });
                    
                    courseDiv.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            if (selectedCourseKey === course.key) {
                                window.clearHighlights();
                            } else {
                                window.highlightRelatedCourses(course.key);
                            }
                        }

                        if ((e.key === 'i' || e.key === 'I') && courseDiv.getAttribute('data-has-notes') === 'true') {
                            e.preventDefault();
                            const rect = courseDiv.getBoundingClientRect();
                            const syntheticEvent = {
                                clientX: rect.left + rect.width / 2,
                                clientY: rect.top + rect.height / 2,
                                stopPropagation: () => {}
                            };
                            showNotesTooltip(course.key, syntheticEvent, courseDiv);
                        }

                        if ((e.key === 'a' || e.key === 'A') && courseDiv.getAttribute('data-has-alternatives') === 'true') {
                            e.preventDefault();
                            const rect = courseDiv.getBoundingClientRect();
                            const syntheticEvent = {
                                clientX: rect.left + rect.width / 2,
                                clientY: rect.bottom,
                                stopPropagation: () => {}
                            };
                            const altIndicator = courseDiv.querySelector('.alternatives-indicator');
                            showAlternativesTooltip(course.key, syntheticEvent, altIndicator);
                        }
                    });
                    
                    column.appendChild(courseDiv);
                });
                
                container.appendChild(column);
            });
        }

        window.switchProgram = function() {
            const select = document.getElementById('programSelect');
            const newProgram = select.value;

            if (newProgram === currentProgram) return;

            // Close any open tooltips
            closeNotesTooltip();
            closeAlternativesTooltip();

            // Clear highlights
            window.clearHighlights();

            // Update current program
            currentProgram = newProgram;
            courseData = programsData[currentProgram].courseData;
            semesterOrder = programsData[currentProgram].semesterOrder;

            // Update global references
            window.courseData = courseData;
            window.semesterOrder = semesterOrder;

            // Update page title
            const programTitle = document.getElementById('programTitle');
            if (programTitle) {
                programTitle.textContent = programsData[currentProgram].fullTitle;
            }

            // Clear existing flowchart and text view
            const flowchartContainer = document.getElementById('flowchartContainer');
            const textContent = document.getElementById('textContent');
            const svg = document.getElementById('connectionsSvg');

            if (flowchartContainer) flowchartContainer.innerHTML = '';
            if (textContent) textContent.innerHTML = '';
            if (svg) svg.innerHTML = '';

            // Rebuild everything
            leadsToMap = buildLeadsToMap();
            buildFlowchart();
            buildTextView();
            setupScrollIndicators();
            createArrowMarkers();
            updateSVGSize();

            // Announce the change
            const announcer = document.getElementById('announcements');
            if (announcer) {
                announcer.textContent = `Switched to ${programsData[currentProgram].name} program.`;
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Check for URL parameter to set initial program
            const urlParams = new URLSearchParams(window.location.search);
            const programParam = urlParams.get('program');
            if (programParam && programsData[programParam]) {
                currentProgram = programParam;
                courseData = programsData[currentProgram].courseData;
                semesterOrder = programsData[currentProgram].semesterOrder;
                window.courseData = courseData;
                window.semesterOrder = semesterOrder;

                // Update dropdown
                const select = document.getElementById('programSelect');
                if (select) select.value = currentProgram;

                // Update title
                const programTitle = document.getElementById('programTitle');
                if (programTitle) {
                    programTitle.textContent = programsData[currentProgram].fullTitle;
                }
            }

            leadsToMap = buildLeadsToMap();
            buildFlowchart();
            buildTextView();
            setupScrollIndicators();
            createArrowMarkers();

            updateSVGSize();

            window.addEventListener('resize', updateSVGSize);
            
            document.addEventListener('click', (e) => {
                // Close tooltips if clicking outside
                const notesTooltip = document.getElementById('notesTooltip');
                const alternativesTooltip = document.getElementById('alternativesTooltip');

                if (notesTooltip && notesTooltip.classList.contains('visible')) {
                    if (!e.target.closest('#notesTooltip') && !e.target.closest('.notes-indicator')) {
                        closeNotesTooltip();
                    }
                }

                if (alternativesTooltip && alternativesTooltip.classList.contains('visible')) {
                    if (!e.target.closest('#alternativesTooltip') && !e.target.closest('.alternatives-indicator')) {
                        closeAlternativesTooltip();
                    }
                }

                // Clear course highlights if clicking outside
                if (!e.target.closest('.course') && selectedCourseKey) {
                    window.clearHighlights();
                }
            });
        });
        
        function setupScrollIndicators() {
            const container = document.getElementById('flowchartContainer');
            const indicatorsDiv = document.getElementById('scrollIndicators');
            const wrapper = document.getElementById('visualView');

            if (!container || !indicatorsDiv || !wrapper) return;

            // Clear existing indicators
            indicatorsDiv.innerHTML = '';

            semesterOrder.forEach((semester, index) => {
                const dot = document.createElement('button');
                dot.className = 'scroll-dot';
                dot.setAttribute('type', 'button');
                dot.setAttribute('aria-label', `Jump to ${semester}`);
                
                if (index === 0) {
                    dot.classList.add('active');
                }
                
                dot.addEventListener('click', () => {
                    const columns = container.querySelectorAll('.semester-column');
                    if (columns[index]) {
                        columns[index].scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'nearest', 
                            inline: 'start' 
                        });
                    }
                });
                
                indicatorsDiv.appendChild(dot);
            });
            
            let scrollTimeout;
            wrapper.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    updateActiveIndicator();
                }, 100);
            });
        }
        
        function updateActiveIndicator() {
            const wrapper = document.getElementById('visualView');
            const container = document.getElementById('flowchartContainer');
            const dots = document.querySelectorAll('.scroll-dot');
            
            if (!wrapper || !container || dots.length === 0) return;
            
            const scrollLeft = wrapper.scrollLeft;
            const wrapperWidth = wrapper.clientWidth;
            const scrollWidth = wrapper.scrollWidth;
            const columns = container.querySelectorAll('.semester-column');
            
            const visibleLeft = scrollLeft;
            const visibleRight = scrollLeft + wrapperWidth;
            
            if (scrollLeft + wrapperWidth >= scrollWidth - 5) {
                dots.forEach((dot, index) => {
                    if (index === dots.length - 1) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                    
                    const column = columns[index];
                    const columnLeft = column.offsetLeft - container.offsetLeft;
                    const columnRight = columnLeft + column.offsetWidth;
                    const isInView = columnRight > visibleLeft && columnLeft < visibleRight;
                    
                    if (isInView) {
                        dot.classList.remove('out-of-view');
                    } else {
                        dot.classList.add('out-of-view');
                    }
                });
                return;
            }
            
            if (scrollLeft <= 5) {
                dots.forEach((dot, index) => {
                    if (index === 0) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                    
                    const column = columns[index];
                    const columnLeft = column.offsetLeft - container.offsetLeft;
                    const columnRight = columnLeft + column.offsetWidth;
                    const isInView = columnRight > visibleLeft && columnLeft < visibleRight;
                    
                    if (isInView) {
                        dot.classList.remove('out-of-view');
                    } else {
                        dot.classList.add('out-of-view');
                    }
                });
                return;
            }
            
            let activeIndex = 0;
            let minDistance = Infinity;
            
            columns.forEach((column, index) => {
                const columnLeft = column.offsetLeft - container.offsetLeft;
                const distance = Math.abs(scrollLeft - columnLeft);
                
                if (distance < minDistance) {
                    minDistance = distance;
                    activeIndex = index;
                }
            });
            
            dots.forEach((dot, index) => {
                if (index === activeIndex) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
                
                const column = columns[index];
                const columnLeft = column.offsetLeft - container.offsetLeft;
                const columnRight = columnLeft + column.offsetWidth;
                const isInView = columnRight > visibleLeft && columnLeft < visibleRight;
                
                if (isInView) {
                    dot.classList.remove('out-of-view');
                } else {
                    dot.classList.add('out-of-view');
                }
            });
        }
        
        function buildTextView() {
            const container = document.getElementById('textContent');

            const courseBySemester = {};
            semesterOrder.forEach(sem => courseBySemester[sem] = []);

            Object.entries(courseData).forEach(([key, course]) => {
                courseBySemester[course.semester].push({key, ...course});
            });

            semesterOrder.forEach(semester => {
                const semesterDiv = document.createElement('div');
                semesterDiv.className = 'text-semester';

                const header = document.createElement('h3');
                header.textContent = semester;
                semesterDiv.appendChild(header);

                courseBySemester[semester].forEach(course => {
                    const courseDiv = document.createElement('div');
                    courseDiv.className = `text-course ${course.type}`;

                    const heading = document.createElement('h4');
                    heading.textContent = `${course.code} - ${course.name} (${course.credits} credits)`;
                    courseDiv.appendChild(heading);

                    const typeMap = {
                        'engineering': 'Engineering',
                        'science': course.code.startsWith('MATH') ? 'Math' : 'Science',
                        'ucore': 'UCORE',
                        'technical': 'Technical Elective'
                    };

                    const typeP = document.createElement('p');
                    typeP.textContent = `Type: ${typeMap[course.type]}`;
                    courseDiv.appendChild(typeP);

                    const prereqP = document.createElement('p');
                    if (course.prereqs.length > 0) {
                        const prereqNames = course.prereqs.map(p => courseData[p]?.code || p).join(', ');
                        prereqP.innerHTML = `<strong>Prerequisites:</strong> ${prereqNames}`;
                    } else {
                        prereqP.innerHTML = `<strong>Prerequisites:</strong> None`;
                    }
                    courseDiv.appendChild(prereqP);

                    if (course.coreqs.length > 0) {
                        const coreqP = document.createElement('p');
                        const coreqNames = course.coreqs.map(c => courseData[c]?.code || c).join(', ');
                        coreqP.innerHTML = `<strong>Co-requisites:</strong> ${coreqNames}`;
                        courseDiv.appendChild(coreqP);
                    }

                    if (course.alternatives && course.alternatives.length > 0) {
                        const altP = document.createElement('p');
                        if (course.alternatives.length === 1) {
                            altP.innerHTML = `<strong>Alternative:</strong> ${course.alternatives[0]}`;
                        } else {
                            const altList = course.alternatives.map((alt, index) =>
                                `<br>&nbsp;&nbsp;Option ${index + 1}: ${alt}`
                            ).join('');
                            altP.innerHTML = `<strong>Alternatives:</strong>${altList}`;
                        }
                        courseDiv.appendChild(altP);
                    }

                    if (course.notes && course.notes.trim() !== '') {
                        const notesP = document.createElement('p');
                        notesP.innerHTML = `<strong>Notes:</strong> ${course.notes}`;
                        notesP.style.fontStyle = 'italic';
                        notesP.style.color = '#444';
                        courseDiv.appendChild(notesP);
                    }

                    semesterDiv.appendChild(courseDiv);
                });

                container.appendChild(semesterDiv);
            });
        }

        window.toggleLegend = function() {
            const heading = document.getElementById('legendToggle');
            const content = document.getElementById('legendContent');

            const isCollapsed = heading.classList.toggle('collapsed');
            content.classList.toggle('hidden');

            heading.setAttribute('aria-expanded', !isCollapsed);
        };

        window.toggleKeyboardHint = function() {
            const heading = document.getElementById('keyboardToggle');
            const list = document.getElementById('keyboardList');

            const isCollapsed = heading.classList.toggle('collapsed');
            list.classList.toggle('hidden');

            heading.setAttribute('aria-expanded', !isCollapsed);
        };

        let currentView = 'visual';
        window.toggleView = function() {
            const visualView = document.getElementById('visualView');
            const textView = document.getElementById('textView');
            const scrollControls = document.querySelector('.scroll-controls');
            const btn = document.getElementById('toggleBtn');
            const announcer = document.getElementById('announcements');

            if (currentView === 'visual') {
                visualView.style.display = 'none';
                textView.style.display = 'block';
                scrollControls.style.display = 'none';
                btn.textContent = 'Switch to Visual Flowchart';

                if (announcer) {
                    announcer.textContent = 'Switched to text-only view. Courses are now listed by semester with full details.';
                }

                currentView = 'text';
            } else {
                visualView.style.display = 'block';
                textView.style.display = 'none';
                scrollControls.style.display = 'block';
                btn.textContent = 'Switch to Text-Only View';

                if (announcer) {
                    announcer.textContent = 'Switched to visual flowchart view. Interactive course boxes are now displayed.';
                }

                currentView = 'visual';
            }
        };
        
        document.addEventListener('keydown', (e) => {
            const focusedElement = document.activeElement;
            
            if (e.key === 'Escape') {
                const notesTooltip = document.getElementById('notesTooltip');
                const alternativesTooltip = document.getElementById('alternativesTooltip');

                if (notesTooltip && notesTooltip.classList.contains('visible')) {
                    closeNotesTooltip();
                }

                if (alternativesTooltip && alternativesTooltip.classList.contains('visible')) {
                    closeAlternativesTooltip();
                }

                window.clearHighlights();
                return;
            }
            
            if (e.key === 'v' || e.key === 'V') {
                if (!focusedElement.matches('input, textarea')) {
                    toggleView();
                }
                return;
            }
            
            if (!focusedElement.classList.contains('course')) return;
            
            const allCourses = Array.from(document.querySelectorAll('.course'));
            const currentIndex = allCourses.indexOf(focusedElement);
            let nextIndex = currentIndex;
            
            const currentColumn = focusedElement.closest('.semester-column');
            const columns = Array.from(document.querySelectorAll('.semester-column'));
            const columnIndex = columns.indexOf(currentColumn);
            const coursesInColumn = Array.from(currentColumn.querySelectorAll('.course'));
            const positionInColumn = coursesInColumn.indexOf(focusedElement);
            
            switch(e.key) {
                case 'ArrowRight':
                    e.preventDefault();
                    if (columnIndex < columns.length - 1) {
                        const nextColumn = columns[columnIndex + 1];
                        const nextColumnCourses = Array.from(nextColumn.querySelectorAll('.course'));
                        const targetCourse = nextColumnCourses[Math.min(positionInColumn, nextColumnCourses.length - 1)];
                        if (targetCourse) targetCourse.focus();
                    }
                    break;
                    
                case 'ArrowLeft':
                    e.preventDefault();
                    if (columnIndex > 0) {
                        const prevColumn = columns[columnIndex - 1];
                        const prevColumnCourses = Array.from(prevColumn.querySelectorAll('.course'));
                        const targetCourse = prevColumnCourses[Math.min(positionInColumn, prevColumnCourses.length - 1)];
                        if (targetCourse) targetCourse.focus();
                    }
                    break;
                    
                case 'ArrowDown':
                    e.preventDefault();
                    if (positionInColumn < coursesInColumn.length - 1) {
                        coursesInColumn[positionInColumn + 1].focus();
                    }
                    break;
                    
                case 'ArrowUp':
                    e.preventDefault();
                    if (positionInColumn > 0) {
                        coursesInColumn[positionInColumn - 1].focus();
                    }
                    break;
            }
        });
    </script>
</body>
</html>
